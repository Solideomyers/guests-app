// Prisma Schema for Guest Management System
// Generated: 2025-10-16

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// MODELS
// ============================================

model Guest {
  id               Int              @id @default(autoincrement())
  firstName        String           @db.VarChar(100)
  lastName         String?          @db.VarChar(100)
  address          String?          @db.VarChar(255)
  state            String?          @db.VarChar(100)
  city             String?          @db.VarChar(100)
  church           String?          @db.VarChar(200)
  phone            String?          @db.VarChar(20)
  notes            String?          @db.Text
  status           GuestStatus      @default(PENDING)
  isPastor         Boolean          @default(false)
  registrationDate DateTime         @default(now())
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  deletedAt        DateTime?        // Soft delete
  
  history          GuestHistory[]
  
  // √çndices para optimizar queries
  @@index([status])
  @@index([church])
  @@index([city])
  @@index([isPastor])
  @@index([firstName, lastName])
  @@index([deletedAt])
  @@map("guests")
}

model GuestHistory {
  id        Int      @id @default(autoincrement())
  guestId   Int
  guest     Guest    @relation(fields: [guestId], references: [id], onDelete: Cascade)
  action    String   @db.VarChar(50)   // CREATE, UPDATE, DELETE, STATUS_CHANGE
  field     String?  @db.VarChar(50)   // Campo modificado
  oldValue  String?  @db.Text
  newValue  String?  @db.Text
  changedBy String?  @db.VarChar(100)  // Usuario que hizo el cambio (futuro)
  createdAt DateTime @default(now())
  
  @@index([guestId])
  @@index([createdAt])
  @@map("guest_history")
}

// ============================================
// ENUMS
// ============================================

enum GuestStatus {
  PENDING
  CONFIRMED
  DECLINED
}
