// Prisma Schema for Guest Management System - TEST ENVIRONMENT
// SQLite version for fast integration tests

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// MODELS
// ============================================

model Guest {
  id               Int              @id @default(autoincrement())
  firstName        String
  lastName         String?
  address          String?
  state            String?
  city             String?
  church           String?
  phone            String?
  notes            String?
  status           GuestStatus      @default(PENDING)
  isPastor         Boolean          @default(false)
  registrationDate DateTime         @default(now())
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  deletedAt        DateTime?        // Soft delete
  
  history          GuestHistory[]
  
  @@index([status])
  @@index([church])
  @@index([city])
  @@index([isPastor])
  @@index([firstName, lastName])
  @@index([deletedAt])
  @@map("guests")
}

model GuestHistory {
  id        Int      @id @default(autoincrement())
  guestId   Int
  guest     Guest    @relation(fields: [guestId], references: [id], onDelete: Cascade)
  action    String
  field     String?
  oldValue  String?
  newValue  String?
  changedBy String?
  createdAt DateTime @default(now())
  
  @@index([guestId])
  @@index([createdAt])
  @@map("guest_history")
}

// ============================================
// ENUMS
// ============================================

enum GuestStatus {
  PENDING
  CONFIRMED
  DECLINED
}
